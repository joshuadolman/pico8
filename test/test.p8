pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
function _init()
end

plyr={
	id="plyr",
	state="sprint",
	x=40,
	y=50,
	--w=1,
	h=2,
	anim_time=0,
	anim=1,
	hflip=false,
	vlfip=false,
}

slime={
	id="slime",
	state="idle",
	x=60,
	y=58,
	anim_time=0,
	anim=1,
}

anims={
	plyr={
		sprint={
			a={2,1,3,1},
			l=12,
		},
		idle={
			a={1},
			l=30,
		},
	},
	slime={
		idle={
			a={16,32},
			l=12,
		},
	},
}

-->8
--update

function _update60()
	plyr.state="idle"
	if btn(0) then
		plyr.x-=1
		plyr.state="sprint"
		plyr.hflip=true
	end
	if btn(1) then
		plyr.x+=1
		plyr.state="sprint"
		plyr.hflip=false
	end
	update_anim(plyr)
	update_anim(slime)
end

function update_anim(obj)
	--obj requires:
		--anim_time
		--anim
		--id
			--in "anims" global table
		--state
			--for every possible state, entry in "anims" global table
		
	obj.anim_time+=1
	if obj.anim_time>=anims[obj.id][obj.state].l then
		obj.anim_time=0
		obj.anim+=1
	end
	if obj.anim>#anims[obj.id][obj.state].a then
			obj.anim=1
		end
	
end

-->8
--draw

function _draw()
	cls(0)
	--spr(anims[plyr.id][plyr.state].a[plyr.anim], plyr.x, plyr.y, 1, 2, plyr.hflip, plyr.vflip)
	--spr(anims[slime.id][slime.state].a[slime.anim],50,48)
	draw_obj(plyr)
	draw_obj(slime)
	print(plyr.state,0,0,7)
	print(plyr.anim,0,7,7)
	print(plyr.anim_time,0,14,7)
	print(#anims[plyr.id][plyr.state].a,0,21,7)
end

function draw_obj(obj)
	--obj requires:
		--entries in anims global table for id and all states
		--anim
		--x,y
		--optionally:
			--w,h (in pixels)
			--hlfip, vflip
		local id,state,anim = obj.id,obj.state,obj.anim
		local x,y= obj.x, obj.y
		local w,h,hflip,vflip=1,1,false,false
		if obj.w then w=obj.w end
		if obj.h then h=obj.h end
		if obj.hflip then hflip=true end
		if obj.vflip then vflip=true end
		if w>1 then flr((w+8)/8) end
		if h>1 then flr((h+8)/8) end
	spr(anims[id][state].a[anim],x,y,w,h,hflip,vflip)
end
__gfx__
00000000002882000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008888800028820000288200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700004f5f000088888000888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000fffff0004f5f00004f5f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000fff0000fffff000fffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000344000003fff00003fff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000444b3000444b4000444b4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a43f3000a43f30f0a43f3f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000443f30004433ff0044f330f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033000443f30004433300044ff3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300001110000011100000211000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03bb7b300011d000001120000012d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbbbb30001d00001d01d0001101d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbbbb3000110005100011051000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbbbb3000555005000005550000055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03bb7b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbb7b3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbbbb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbbbb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
